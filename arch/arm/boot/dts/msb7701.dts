/*
 * Copyright (C) 2016 Fujitsu Electronics Inc.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

/dts-v1/;
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/thermal/thermal.h>

#include "mb86s71.dtsi"

// #include "msb7701-mipi.dtsi"
// #include "msb7701-i2s.dtsi"
// #include "msb7701-hsspi.dtsi"


/ {
	model = "Fujitsu Electronics MSB7701 Board";
	compatible = "fujitsu,mb86s71";

	memory {
		device_type = "memory";
		reg = <0 0x80000000 0x80000000>;
	};

	chosen {
		bootargs = "shm_offset=2048 loglevel=4 console=ttyAMA0,115200 root=/dev/mmcblk0p1 rootfstype=ext4 rootwait rw pcie_ports=native ";

		linux,initrd-start = <0x88000000>;
		linux,initrd-end =   <0x88800000>;
		/* Backward compatibility for 2016.03-1-1 */
		/* linux,initrd-start = <0xc0000000>; */
		/* linux,initrd-end =   <0xc0800000>; */
	};

	gpio0: mb86s70_gpio0 {
		compatible = "fujitsu,mb86s70-gpio";
		reg = <0 0x31000000 0x10000>;
		gpio-controller;
		#gpio-cells = <2>;
		clocks = <&clk_alw_5_8>;
		base = <0>;
		resume_function_enabled = <12>, <13> , <14>, <15>, <29>;
		power-domains = <&power 1>;
	};

	gpio1: mb86s70_gpio1 {
		compatible = "fujitsu,mb86s70-gpio";
		reg = <0 0x31010000 0x10000>;
		gpio-controller;
		#gpio-cells = <2>;
		clocks = <&clk_alw_5_8>;
		base = <32>;
		resume_function_enabled = <32>, <33>, <34>, <35>, <36>, <37>, <38>, <39>, <40>, <41>, <42>, <43>, <46>;
		power-domains = <&power 1>;
	};

	i2c0 {
		compatible = "fujitsu,f_i2c";
		reg = <0 0x31200000 0x10000>;
		interrupts = <0 312 0x4>;
		#address-cells = <1>;
		#size-cells = <0>;
		clock-frequency = <100000>;
		clocks = <&clk_alw_5_8>;
		power-domains = <&power 1>;
	};

	i2c1 {
		compatible = "fujitsu,f_i2c";
		reg = <0 0x31210000 0x10000>;
		interrupts = <0 313 0x4>;
		#address-cells = <1>;
		#size-cells = <0>;
		clock-frequency = <100000>;
		clocks = <&clk_alw_5_8>;
		power-domains = <&power 1>;
	};

	hsspi: hsspi.0 {
		compatible = "fujitsu,mb86s7x-hsspi";
		reg = <0 0x30010000 0x1000>,
		      <0 0x48000000 0x1000000>;
		interrupts = <0 361 0x4>,
			     <0 360 0x4>,
			     <0 362 0x4>;
		mode = <1>; // HS_SPI_DIRECT_MODE
		read_operation = <1>; // HS_SPI_NORMAL_READ
		write_operation = <5>; // HS_SPI_NORMAL_WRITE
		active_clk_edges;
		bank_size = <0x01000000>;	// 16MB flash bank
		num_chipselect = <2>;
		addr_width = <3>;
		dma_rx_dreq = <0x800000>; // XDDES_TF_DREQ6 !!! GUESSED
		dma_tx_dreq = <0x900000>; // XDDES_TF_DREQ7 !!! GUESSED
		dma_channel = <0>;
		sync_on = <1>;
		clock = <0>; // HS_SPI_HCLK
		clocks = <&clk_alw_1_8>, <&clk_main_6_8>;
		clock-names = "iHCLK", "iPCLK";
		#address-cells = <1>;
		#size-cells = <0>;

		flash@0 {
			compatible = "n25q128a11";
			spi-max-frequency = <62500000>;
			spi-rx-bus-width = <4>;
			spi-tx-bus-width = <4>;
			reg = <0>;
			spi-cpha;
			spi-cpol;
			#address-cells = <1>;
			#size-cells = <1>;

			spipart0@0 {
				label = "scb-spi-firmware";
				reg = <0 0x200000>;
			};

			spipart1@1 {
				label = "spi-romfs";
				reg = <0x200000 0x100000>;
			};

			spipart2@2 {
				label = "spi-user0";
				reg = <0x300000 0xd00000>;
			};
		};
	};

	/* Enable UART0/1/2 of MSB7701 Board */
	serial@0x31040000 {
		status = "okay";
	};
	serial@0x31050000 {
		status = "okay";
	};
	serial@0x31060000 {
		status = "okay";
	};

	timer0: timer0@31080000 {
		#clock-cells = <1>;
		compatible = "arm,sp804";
		reg = <0 0x31080000 0x10000>;
		interrupts = <0 324 4>,
			     <0 325 4>;
		clocks = <&clk_alw_6_8>;
	};

	timer {
		compatible = "arm,armv7-timer";
		clock-frequency = <125000000>;
		interrupts = <1 13 0xf08>, /* PHYS Secure */
			     <1 14 0xf08>; /* PHYS Non-Secure */
	};
};

/* Video Port Selection */

/*
 These statuses are configured by boot loader automatically if "auto".
 If NOT "auto", the status is never changed by boot loader.
 Don't activate both MIPI-DSI Type and HDMI Type video ports simultaneously.
*/

&videophy0 { /* MIPI-DSI Type Video PHY configuration */
	status = "auto";
	/* "okay":	MIPI-DSI Type video activated */
	/* "disabled":	MIPI-DSI Type video disabled */
	/* "auto":	Selected MIPI-DSI Type or HDMI Type by boot loader */
};

&videophy1 { /* HDMI Type Video PHY configuration */
	status = "auto";
	/* "okay":	HDMI Type video activated */
	/* "disabled":	HDMI Type video disabled */
	/* "auto":	Selected MIPI-DSI Type or HDMI Type by boot loader */
};

&fb0 {
	status = "auto";
	/* "okay":	MIPI-DSI Type video activated */
	/* "disabled":	MIPI-DSI Type video disabled */
	/* "auto":	Selected MIPI-DSI Type or HDMI Type by boot loader */

	/* EVB LCD timings / resolution (mipidsi) */
	mode  = "1280x768x32bpp";
};

&fb1 {
	status = "auto";
	/* "okay":	HDMI Type activated */
	/* "disabled":	HDMI Type disabled */
	/* "auto":	Selected MIPI-DSI Type or HDMI Type by boot loader */
};

&fdbdrm0 {
	status = "auto";
	/* "okay":	Activated it */
	/* "disabled":	Disabled it */
	/* "auto":	Selected MIPI-DSI Type or HDMI Type by boot loader */

	/* Don't remove following two address for boot loader auto video configuration. */
	fb0_addr = <&fb0>;
	fb1_addr = <&fb1>;
	bind = <0>;
	/*  <0>:	To be configured &fb0 for MIPI-DSI Type or &fb1 for HDMI Type by boot loader. */
	/*  <&fb0>:	MIPI-DSI Type video activated with status okay */
	/*  <&fb1>:	HDMI Type video activated with status okay */


};


/* HDMI Type Audio configuration */
/* 
  HDMI Type audio can be used only with HDMI Type video configuration, so it
   cannot be used with MIPI-DSI Type video configuration.
*/


&f_hdmi_audio_dai {
	status = "auto";
	/* "okay":	HDMI Type audio activated */
	/* "disabled":	HDMI Type audio disabled */
	/* "auto":	Selected by boot loader with HDMI Type video */
};

&f_hdmi_codec {
	status = "auto";
	/* "okay":	HDMI Type audio activated */
	/* "disabled":	HDMI Type audio disabled */
	/* "auto":	Selected by boot loader with HDMI Type video */
};

&f_hdmi_audio {
	status = "auto";
	/* "okay":	HDMI Type audio activated */
	/* "disabled":	HDMI Type audio disabled */
	/* "auto":	Selected by boot loader with HDMI Type video */
};

&sdhci2 {
/*	status = "disabled"; */
	enable-fixed-18v;
};

